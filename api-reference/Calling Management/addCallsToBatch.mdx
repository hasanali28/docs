---
title: "Add Calls to Batch"
description: "Queue one or more contacts in an existing batch before launching the dialer."
openapi: "POST /api/call/addCallsToBatch"
---

## Overview
After creating a batch you can enqueue contact records that the dialer should process. Each record can include any custom fields your agent definition expects. Validation runs against the agent’s variable schema so you catch missing data before the dialer starts.

## Prerequisites
- You created the batch and captured its `batchId`.
- All required agent variables are present in every contact.
- The API key you use owns the batch.

## Request
<ParamField header="x-api-key" type="string" required>
Workspace API key. Must match the owner of the target batch.
</ParamField>

<ParamField body="batchId" type="string" required>
Identifier returned by `POST /api/call/createBatch`.
</ParamField>

<ParamField body="call_data" type="array[object]" required>
Array of call records to be added to the batch. Each object must include `phoneNumber` and any custom variables required by the agent. The system automatically chunks large arrays (1000 records per chunk) for efficient processing.
</ParamField>

<RequestExample>
```bash cURL
curl --location '{{baseUrl}}/api/call/addCallsToBatch' \
  --header 'x-api-key: YOUR_API_KEY' \
  --header 'Content-Type: application/json' \
  --data '{
    "batchId": "64e5f12345abcdef98765432",
    "call_data": [
      {
        "phoneNumber": "919876543210",
        "customer_name": "Praveen",
        "loan_amount": 30000,
        "loan_tenure": 40,
        "lead_id": "1094436",
        "completedStage": "lead_eligibility_pass",
        "upcomingStage": "lead_loan_offer"
      }
    ]
  }'
```
</RequestExample>

## Response

<ResponseExample>
```json 200 OK
{
  "success": true,
  "added": 1000,
  "callIds": ["64e5f12345abcdef11111111", "64e5f12345abcdef22222222"]
}
```
</ResponseExample>

<ResponseExample>
```json 207 Partial Content
{
  "success": false,
  "partial": true,
  "added": 500,
  "callIds": ["64e5f12345abcdef11111111"],
  "failedChunks": [
    {
      "chunkNum": 2,
      "error": "Database connection error"
    }
  ]
}
```
</ResponseExample>

<ResponseField name="success" type="boolean" required>
Indicates whether all chunks were processed successfully. `false` with `partial: true` means some chunks succeeded.
</ResponseField>

<ResponseField name="added" type="integer" required>
Total number of call records successfully added to the batch across all chunks.
</ResponseField>

<ResponseField name="callIds" type="array[string]" required>
Array of call record IDs that were inserted or updated.
</ResponseField>

<ResponseField name="partial" type="boolean">
Present when `success` is `false`, indicating that some chunks succeeded while others failed.
</ResponseField>

<ResponseField name="failedChunks" type="array[object]">
Array of chunk processing failures, each containing `chunkNum` and `error` message.
</ResponseField>

## Error Handling

- **400 Bad Request** – Missing `batchId`, empty `call_data` array, or validation failure.
- **403 Forbidden** – Invalid or missing API key, or API key doesn't own the batch.
- **404 Not Found** – Batch not found, or no agent found for the batch's calling numbers.
- **207 Partial Content** – Some chunks processed successfully while others failed. Check `failedChunks` for details.
- **500 Internal Server Error** – Server error during processing; retry with exponential backoff.

<Note>
**Processing Details:**

- Large arrays are automatically chunked into batches of 1000 records for efficient processing
- Each call record is validated against the agent's required variables
- Existing calls with the same phone number are updated if they have a "pending" status
- Completed calls create new phone log entries
- The system automatically starts the calling service after successful insertion
- Timezone information is applied to each call record if not provided
</Note>

<Tip>
You can safely enqueue thousands of contacts in a single request. The system handles chunking automatically. Monitor the response for `partial: true` to identify any failed chunks that may need retry.
</Tip>
